# 5ì£¼ì°¨ í‚¤ì›Œë“œ ì •ë¦¬ğŸ¯

## Domain
### ë„ë©”ì¸(Domain)?
- ë„ë©”ì¸ì€ ì¼ë°˜ì ì¸ ìš”êµ¬ì‚¬í•­, ì „ë¬¸ ìš©ì–´, ê·¸ë¦¬ê³  ì»´í“¨í„° í”„ë¡œê·¸ë˜ë° ë¶„ì•¼ì—ì„œ ë¬¸ì œë¥¼ í’€ê¸° ìœ„í•´ ì„¤ê³„ëœ ì–´ë–¤ ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œê·¸ë¨ì— ëŒ€í•œ ê¸°ëŠ¥ì„±ì„ ì •ì˜í•˜ëŠ” ì—°êµ¬ì˜ í•œ ì˜ì—­ì´ë‹¤.
  ì¦‰, ë„ë©”ì¸ì€ ê¸°íšì˜ ìš”êµ¬ì‚¬í•­ì„ êµ¬í˜„í•˜ê³ , ë¬¸ì œë¥¼ í’€ê¸° ìœ„í•´ ì„¤ê³„ëœ ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œê·¸ë¨ì˜ ê¸°ëŠ¥ì„±ì„ ì •ì˜í•˜ëŠ” ì˜ì—­ì´ë¼ê³  ì •ì˜í•œë‹¤.
- ***`Domain`ì´ë€ ì‚¬ìš©ìê°€ ì´ìš©í•˜ëŠ” ì•± ê¸°ëŠ¥, íšŒì‚¬ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì •ì˜í•˜ëŠ” ì˜ì—­ì´ë¼ê³  ì´í•´í•´ ë³¼ ìˆ˜ ìˆë‹¤.***

### ê·¸ëŸ¼ ë„ë©”ì¸(Domain)ê³¼ ì—”í‹°í‹°(Entity)ëŠ” ê°™ì€ ë§ì´ ì•„ë‹Œê°€ìš”?ğŸ˜¯
- `Entity`?: ì¼ë°˜ì ìœ¼ë¡œ ì‹¤ì²´ë¥¼ ì˜ë¯¸í•œë‹¤. ë‹¤ì–‘í•œ ë§¥ë½ì—ì„œ `Entity`ì˜ ì˜ë¯¸ëŠ” ë‹¤ì–‘í•˜ê²Œ êµ¬ì²´í™” ë˜ì–´ ì‚¬ìš©ëœë‹¤.
- `Domain`ì€ ë¹„ì§€ë‹ˆìŠ¤ ì˜ì—­ì„ ì¶”ìƒì ìœ¼ë¡œ ë‚˜íƒ€ë‚´ëŠ” ê°œë…, `Entity`ëŠ” `Domain`ë‚´ì—ì„œ ì‹¤ì œ ê°œë³„ ê°ì²´ë‚˜ ê°œë…ì„ ë‚˜íƒ€ë‚¸ë‹¤.

### ë„ë©”ì¸ì˜ ì˜ˆì‹œ
> ì˜¨ë¼ì¸ ì„œì  ë„ë©”ì¸
![image1.png](image1.png)

- ì¹´íƒˆë¡œê·¸ í•˜ìœ„ ë„ë©”ì¸ì€ ê³ ê°ì—ê²Œ êµ¬ë§¤í•  ìˆ˜ ìˆëŠ” ìƒí’ˆ ëª©ë¡ì„ ì œê³µí•˜ê³ , ì£¼ë¬¸ í•˜ìœ„ ë„ë©”ì¸ì€ ê³ ê°ì˜ ì£¼ë¬¸ì„ ì²˜ë¦¬í•œë‹¤.
- í˜œíƒ í•˜ìœ„ ë„ë©”ì¸ì€ ì¿ í°ì´ë‚˜ íŠ¹ë³„ í• ì¸ ê¸°íšŒì™€ ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
- ***í•˜ë‚˜ì˜ í•˜ìœ„ ë„ë©”ì¸ì€ ë‹¤ë¥¸ í•˜ìœ„ ë„ë©”ì¸ê³¼ ì—°ë™í•˜ì—¬ ì™„ì „í•œ ê¸°ëŠ¥ì„ ì œê³µ***í•œë‹¤.
- ë¬¼ë¡  ì†Œí”„íŠ¸ì›¨ì–´ì— í•„ìš”í•œ ëª¨ë“  ë„ë©”ì¸ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤. -> ì™¸ë¶€ì‹œìŠ¤í…œ ì‚¬ìš©ì„ í•¨ìœ¼ë¡œì„œ ì •ë³´ ì œê³µ ê¸°ëŠ¥ë§Œ ì´ìš©ê°€ëŠ¥í•˜ë‹¤.
- ë˜í•œ ***ë©”ì¸ë§ˆë‹¤ ê³ ì •ëœ í•˜ìœ„ ë„ë©”ì¸ì´ í•­ìƒ ì¡´ì¬í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.***
  

> ìœ ì € ë„ë©”ì¸ì„ êµ¬í˜„í•œ ì‹¤ì œ ì—”í‹°í‹°
```java
//import, package ë¶€ë¶„ ìƒëµ
@Entity
@Getter
@Builder
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
public class Member extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 20)
    private String name;

    @Column(nullable = false, length = 20)
    private String nickname;

    @Column(nullable = false, length = 20)
    private String phoneNumber;

    @Enumerated(EnumType.STRING)
    @Column(columnDefinition = "VARCHAR(10)")
    private Gender gender;

    @Enumerated(EnumType.STRING)
    @Column(columnDefinition = "VARCHAR(15) DEFAULT 'ACTIVE'")
    private MemberStatus status;

    private LocalDate inactiveDate;

    @Column(nullable = false, unique = true, length = 50)
    private String email;

    @Column(nullable = false)
    private Integer point = 0;

    @OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<MemberAddress> addressList = new ArrayList<>();

    @OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<MemberAgree> memberAgreeList = new ArrayList<>();

    @OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<MemberPrefer> memberPreferList = new ArrayList<>();

    @OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<Review> reviewList = new ArrayList<>();

    @OneToMany(mappedBy = "member", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<MemberMission> memberMissionList = new ArrayList<>();
}
```

---

## ì–‘ë°©í–¥ ë§µí•‘
### ì–‘ë°©í–¥ ë§µí•‘?
- JPAì™€ ê°™ì€ ORM(Object-Relational Mapping) í”„ë ˆì„ì›Œí¬ì—ì„œ ì—”í‹°í‹° ê°„ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•  ë•Œ, ***ì–‘ìª½ ì—”í‹°í‹°ê°€ ì„œë¡œë¥¼ ì°¸ì¡°í•˜ë„ë¡ ì„¤ì •í•˜ëŠ” ê²ƒ***ì´ë‹¤.
- ì´ë¥¼ í†µí•´ ë‘ ì—”í‹°í‹° ê°„ì˜ ì°¸ì¡°ê°€ ì–‘ë°©í–¥ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤.

### ì–‘ë°©í–¥ ë§µí•‘ì˜ íŠ¹ì§•
- ì–‘ë°©í–¥ ë§¤í•‘ì„ ì„¤ì •í•˜ë©´ ë‘ ì—”í‹°í‹° ì‚¬ì´ì—ì„œ ì„œë¡œ ì°¸ì¡°ê°€ ê°€ëŠ¥í•´ì§„ë‹¤.
- ë”°ë¼ì„œ, ê°ì²´ ì…ì¥ì—ì„  ì¢€ ë” ìì—°ìŠ¤ëŸ¬ìš´ ë°ì´í„° ì¡°íšŒê°€ ê°€ëŠ¥í•˜ë‹¤.
- í•˜ë‚˜ì˜ ì—”í‹°í‹°ê°€ í•´ë‹¹ ê´€ê³„ì˜ `Owner`ê°€ ë˜ê³ , ë‹¤ë¥¸ ì—”í‹°í‹°ëŠ” `Non-Owner`ê°€ ëœë‹¤.
- ê´€ê³„ì˜ `Owner`ëŠ” ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ë¼ ë³´ë©´ ëœë‹¤.
- `Owner`ê°€ ì•„ë‹Œ ì—”í‹°í‹°ëŠ” ***ì½ê¸° ì „ìš©***ìœ¼ë¡œ ì„¤ì •ë˜ì–´, ê´€ê³„ì— ëŒ€í•´ ìˆ˜ì •í•  ìˆ˜ ì—†ê³  ë‹¨ìˆœ ì°¸ì¡°ë§Œ ê°€ëŠ¥í•˜ë‹¤.

### ì–‘ë°©í–¥ ë§µí•‘ì˜ ì˜ˆì‹œ
> - ì´ë²ˆ ê³¼ì œì˜ ë„ë©”ì¸ì¤‘ Regionê³¼ MemberAddressì˜ ê´€ê³„ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.
```java
@Entity
public class Region extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    //mappedByë¡œ ì§€ì •ë˜ì—ˆë‹¤. ì¦‰ ì´ ê´€ê³„ì˜ Ownerê°€ ì•„ë‹ˆë‹¤.
    @OneToMany(mappedBy = "region", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<MemberAddress> memberAddressList = new ArrayList<>();
    
    //ìƒëµ
}
```
```java
@Entity
public class MemberAddress extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    //ì™¸ë˜í‚¤ë¥¼ ê°€ì§€ë©°, ê´€ê³„ì˜ Ownerë¼ í•  ìˆ˜ ìˆë‹¤.
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "region_id", referencedColumnName = "id")
    private Region region;

    // ìƒëµ
}
```

### ì–‘ë°©í–¥ ë§µí•‘ì˜ ì¥ë‹¨ì 
#### ì¥ì 
1. í¸ë¦¬í•œ ì°¸ì¡° ë°©ì‹: ì—”í‹°í‹° ê°„ì˜ ì°¸ì¡°ê°€ ì–‘ìª½ì—ì„œ ê°€ëŠ¥í•˜ë¯€ë¡œ, ì½”ë“œê°€ ì§ê´€ì ì´ê³  ìœ ì—°í•´ì§„ë‹¤.
2. ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì‘ì„± ìš©ì´í•¨: ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°ê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—, ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì‘ì„± ì‹œ ì–‘ìª½ ì—”í‹°í‹° ëª¨ë‘ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ ìœ ì—°í•œ ë¡œì§ì„ ì‘ì„±í•˜ëŠ”ë° ë„ì›€ì„ ì¤€ë‹¤.

#### ë‹¨ì 
1. ë¬´í•œ ë£¨í”„ì˜ ë¬¸ì œ: ì–‘ë°©í–¥ ë©”í•‘ì—ì„œ ë©”ì„œë“œë¥¼ ì˜ëª» êµ¬í˜„ì‹œ ìˆœí™˜ ì°¸ì¡°ë¡œ ì¸í•œ `ë¬´í•œ ë£¨í”„`ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
2. ë³µì¡ì„±ì˜ ì¦ê°€: ì–‘ë°©í–¥ ë§¤í•‘ ì„¤ì •ì‹œ ê°ì²´ ê°„ì˜ ì˜ì¡´ì„±ì´ ì»¤ì ¸ ì½”ë“œê°€ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆë‹¤. 
   - ì–‘ìª½ì˜ ì—°ê´€ê´€ê³„ë¥¼ ***í•­ìƒ ìœ ì§€í•´ì•¼í•œë‹¤.*** ì¦‰ ì‹¤ìˆ˜ë¡œ ê´€ê³„ë¥¼ ë‹¤ë¥¸ í•œìª½ì—ë§Œ ì„¤ì •í•˜ê±°ë‚˜ ë³€ê²½ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.


---

## N + 1 ë¬¸ì œ
> 1ë²ˆì˜ ì¡°íšŒ ì¿¼ë¦¬ ì‹¤í–‰ í›„ Në²ˆì˜ ì¶”ê°€ ì¿¼ë¦¬ê°€ ë°œìƒí•´ë²„ë ¸ë‹¤...

### N + 1ë¬¸ì œ?
- í•œë²ˆì˜ ë°ì´í„° ì¡°íšŒë¡œ ì˜ˆìƒí–ˆë˜ ê²ƒ ë³´ë‹¤ ë” ë§ì€ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ëŠ” ë¬¸ì œì´ë‹¤.
- ì£¼ë¡œ ORM í”„ë ˆì„ì›Œí¬ì—ì„œ `ë‹¤ëŒ€ì¼` í˜¹ì€ `ì¼ëŒ€ë‹¤` ê´€ê³„ë¥¼ ì¡°íšŒì‹œ ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œì´ë‹¤.

### N + 1ë¬¸ì œ ì˜ˆì‹œ
> ë‹¤ì‹œ í•œë²ˆ, `Region`ê³¼ `MemberAddress`ì˜ ê´€ê³„ê°™ì€ `ì¼ëŒ€ë‹¤` ê´€ê³„ë¡œ ì˜ˆì‹œë¥¼ ê°€ì§€ê² ìŠµë‹ˆë‹¤.
```java
@Entity
public class Region extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @OneToMany(mappedBy = "region", cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List<MemberAddress> memberAddressList = new ArrayList<>();
    
    //ìƒëµ
}

@Entity
public class MemberAddress extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "region_id", referencedColumnName = "id")
    private Region region;

    // ìƒëµ
}
```

- ì´ë•Œ `QueryDSL`ì„ ì‚¬ìš©í•˜ì—¬ ë‹¨ìˆœíˆ `Region`ëª©ë¡ì„ ë³¼ë ¤ê³  í•œë‹¤.
- í•´ë‹¹ ì˜ˆì‹œëŠ” ì—”í‹°í‹°ì˜ memberAddressê°€ ***ì§€ì—° ë¡œë”©(Lazy Loading)*** ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´, ê° `Region`ì— ëŒ€í•´ `MemberAddress`ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì¶”ê°€ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.

```java
QRegion region = QRegion.region;
QMemberAddress memberAddress = QMemberAddress.memberAddress;

// Regionë§Œ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ (N+1 ë¬¸ì œ ë°œìƒì´ ê°€ëŠ¥í•˜ë‹¤)
List<Region> regions = queryFactory
        .selectFrom(region)
        .fetch();

// ê° Regionì— ëŒ€í•´ memberAddresses ì ‘ê·¼ ì‹œ ì¶”ê°€ ì¿¼ë¦¬ ë°œìƒ
for (Region region : regions) {
        System.out.println(region.getName() + " has " + region.getMemberAddresses().size() + " members.");
}
// ë§Œì•½ ì§€ì—­ì´ 10ê°œë¼ë©´ ì´ 11ê°œì˜ ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤.
```

### N + 1ë¬¸ì œì˜ í•´ê²° ë°©ë²•?
- ì´í›„ 6ì£¼ì°¨ Keyword.mdì— ì¶”ê°€ ì˜ˆì •ì…ë‹ˆë‹¤.

