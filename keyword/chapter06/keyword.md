# 6ì£¼ì°¨ í‚¤ì›Œë“œ ì •ë¦¬ğŸ¯

## ì§€ì—°ë¡œë”©ê³¼ ì¦‰ì‹œë¡œë”©ì˜ ì°¨ì´
### ë‘˜ì˜ ì°¨ì´? 
- `ì§€ì—° ë¡œë”© (Lazy Loading)`: ì‹¤ì œë¡œ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•  ë•Œ, ì¦‰ í•„ìš”í•œ ìˆœê°„ì—ë§Œ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ì‹ì´ë‹¤.
  - ì¥ì : ì²˜ìŒì— ë¶ˆí•„ìš”í•œ ë°ì´í„°ë¥¼ ì•ˆê°€ì ¸ì˜¨ë‹¤. ***ë©”ëª¨ë¦¬ ì‚¬ìš©ì„ ì¤„ì´ê³  ì„±ëŠ¥ì„ ìµœì í™”***í•  ìˆ˜ ìˆë‹¤.
  - ë‹¨ì : ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ***ì¶”ê°€ ì¿¼ë¦¬***ê°€ ë°œìƒ í•  ìˆ˜ ìˆë‹¤. ì¦‰ N+1 ë¬¸ì œê°™ì€ ì´ìŠˆê°€ ë°œìƒ í•  ìˆ˜ ìˆë‹¤.
  - `@OneToMany`, `@ManyToMany`ì˜ ì„¤ì • ê¸°ë³¸ ê°’ì´ë‹¤.
- `ì¦‰ì‹œ ë¡œë”© (Eager Loading)`: ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ê´€ë ¨ëœ ì—”í‹°í‹°ë„ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ë°©ì‹ì´ë‹¤.
  - ì¥ì : í•„ìš”í•œ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì—, ì¶”ê°€ ì¿¼ë¦¬ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. (N+1 ë¬¸ì œë¥¼ ë°©ì§€í•œë‹¤.)
  - ë‹¨ì : ë¶ˆí•„ìš”í•œ ë°ì´í„°ê¹Œì§€ ëª¨ë‘ ë¡œë“œí•˜ê¸° ë•Œë¬¸ì—, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ê³  ì´ˆê¸° ì¡°íšŒì‹œ ì„±ëŠ¥ ì´ìŠˆê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.
  - `@ManyToOne`, `@OneToOne`ì˜ ì„¤ì • ê¸°ë³¸ ê°’ì´ë‹¤.

### ê·¸ëŸ¼ ê°ê°ì˜ ë¡œë”©ì„ ì–¸ì œ ì‚¬ìš©í•´ì•¼ ì ì ˆí• ê¹Œ?
- `ì§€ì—° ë¡œë”©`ì˜ ì‚¬ìš©
  - ì—°ê´€ëœ ì—”í‹°í‹°ê°€ ë°˜ë“œì‹œ í•„ìš”í•œ ê²½ìš°ê°€ ì•„ë‹ ë•Œ ì‚¬ìš©í•œë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, Orderì™€ OrderItemì˜ ê´€ê³„ì—ì„œ Orderë¥¼ ì¡°íšŒí•  ë•Œ OrderItemì´ í•­ìƒ í•„ìš”í•œ ê²ƒì€ ì•„ë‹ ìˆ˜ ìˆë‹¤. ì´ëŸ° ê²½ìš° ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ í•„ìš”í•  ë•Œë§Œ OrderItemì„ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
  - ì—°ê´€ëœ ë°ì´í„°ê°€ ë§ì€ OneToManyë‚˜ ManyToMany ê´€ê³„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

- `ì¦‰ì‹œ ë¡œë”©`ì˜ ì‚¬ìš©
  - ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ í•„ìš”í•œ ê²½ìš°ì— ì‚¬ìš©í•œë‹¤.

- ê¼­ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì•ìœ¼ë¡œ ì„œìˆ í•  `Fetch join`ì´ë‚˜ `Entity Graph`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ë¥¼ ìµœì í™”í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

---

## Fetch Join
### í˜ì¹˜ ì¡°ì¸ (Fetch Join)?
- í˜ì¹˜ ì¡°ì¸ì€ JPQL(JPA Query Language)ì—ì„œ ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ ì¦‰ì‹œ ë¡œë”©í•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” Join ë°©ì‹ì´ë‹¤.
- ì¼ë°˜ì ì¸ ì¡°ì¸ê³¼ ë‹¤ë¥´ê²Œ, Fetch Joinì€ ì¡°íšŒëœ ì—”í‹°í‹°ì™€ í•¨ê»˜ ì—°ê´€ëœ ì—”í‹°í‹° ì—­ì‹œ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— ì¶”ê°€ì ì¸ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
- í˜ì¹˜ ì¡°ì¸ ì‚¬ìš©ì‹œ `ì§€ì—°ë¡œë”©`ìœ¼ë¡œ ì„¤ì •ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ ë˜í•œ ***ì¦‰ì‹œ ë¡œë”©*** ë˜ë¯€ë¡œ, ì—¬ëŸ¬ ì¿¼ë¦¬ê°€ ì•„ë‹Œ ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ì¡°íšŒëœë‹¤.

### Fetch Join ì‚¬ìš© ì˜ˆì‹œ
> N+1ì˜ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ì˜ˆì‹œ
```java
List<Region> regions = entityManager
    .createQuery("SELECT r FROM Region r", Region.class)
    .getResultList();

// ê° Regionì— ì†í•œ MemberAddress ëª©ë¡ì„ ì¡°íšŒ
for (Region region : regions) {
    System.out.println(region.getName() + " has " + region.getMemberAddresses().size() + " members. ");
}
```
- 5ì£¼ì°¨ Keywordì— ìˆëŠ” N+1ë¬¸ì œì´ë‹¤. ì§€ì—­ì´ 10ê°œë¼ë©´ ì¡°íšŒì»¤ë¦¬ 1ë²ˆì´ 11ë²ˆì˜ ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤.

>`Fetch Join`ì„ í†µí•œ ë¬¸ì œ í•´ê²°
```java
// QueryDSL ì„¤ì •
QRegion region = QRegion.region;
QMemberAddress memberAddress = QMemberAddress.memberAddress;

// QueryDSLë¡œ í˜ì¹˜ ì¡°ì¸ ì„¤ì •
List<Region> regions = queryFactory
        .selectFrom(region)
        .leftJoin(region.memberAddresses, memberAddress).fetchJoin()
        .fetch();
```
- í•´ë‹¹ ì½”ë“œëŠ” `leftJoin().fetchJoin()`ì„ ì‚¬ìš©í•˜ì—¬ ì§€ê²½ê³¼ ë©¤ë²„ì£¼ì†Œë¥¼ í˜ì¹˜ ì¡°ì¸ìœ¼ë¡œ ì¡°íšŒí•œë‹¤.
- ì¦‰, ***ë‹¨ì¼ ì¿¼ë¦¬ `Region`ê³¼ ê·¸ì— ì†í•œ ëª¨ë“  `MemberAddress`ë¥¼ í•œë²ˆì— ê°€ì ¸ì™€ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.***

### Fetch Join ì£¼ì˜ì‚¬í•­
- í˜ì´ì§• ì œí•œ: í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ì—¬ ì»¬ë ‰ì…˜(`OneToMany` ë˜ëŠ” `ManyToMany`)ì„ ì¡°íšŒí•  ë•ŒëŠ” í˜ì´ì§•ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. í˜ì´ì§•ì´ í•„ìš”í•œ ê²½ìš°, ë³„ë„ì˜ ì¿¼ë¦¬ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë¶„ë¦¬í•´ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ `Batch Size` ì„¤ì •ì„ í†µí•´ ìµœì í™”í•´ì•¼ í•œë‹¤.
  - `Batch Size`?: ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œêº¼ë²ˆì— ë¬¶ì–´ì„œ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥.
- ë°ì´í„° ì¤‘ë³µ: í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ì—¬ `ë‹¤ëŒ€ì¼`ì´ë‚˜ `ì¼ëŒ€ì¼` ê´€ê³„ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ, `ì¼ëŒ€ë‹¤` ê´€ê³„ì—ì„œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•  ê²½ìš° ë°ì´í„° ì¤‘ë³µì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. SQL ì¡°ì¸ ë°©ì‹ ë•Œë¬¸ì— `Region`ì´ ì—¬ëŸ¬ `MemberAddress`ë¥¼ ê°€ì§€ë©´, `Region` ë°ì´í„°ê°€ ì¤‘ë³µìœ¼ë¡œ ì¡°íšŒë  ìˆ˜ ìˆë‹¤.
- ë„ˆë¬´ ë§ì€ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë¡œë“œí•˜ëŠ” ê²ƒì€ ìœ ì˜ì‚¬í•­: í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ì—¬ ë„ˆë¬´ ë§ì€ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë¡œë“œí•˜ë©´ ì˜¤íˆë ¤ ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì ì ˆíˆ ì‚¬ìš©í•´ì•¼ í•˜ë©°, í•„ìš”í•œ ì—°ê´€ ì—”í‹°í‹°ë§Œ ì„ íƒì ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

---

## @EntityGraph
### @EntityGraph?
- `@EntityGraph`ëŠ” íŠ¹ì • ì—”í‹°í‹°ì™€ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë‹¤.
- `@EntityGraph` ì‚¬ìš© ì‹œì—, `ì§€ì—° ë¡œë”©`ì´ ì„¤ì •ëœ ì—°ê´€ ì—”í‹°í‹°ë¥¼ íŠ¹ì • ì¡°íšŒ ë©”ì„œë“œì—ì„œ `ì¦‰ì‹œ ë¡œë”©`ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
- ì¦‰ `@EntityGraph`ë˜í•œ Fetch Joinì²˜ëŸ¼ N+1ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ”ë° ë„ì›€ì„ ì¤€ë‹¤.


### @EntityGraphì˜ íŠ¹ì§•
- **N+1 ë¬¸ì œ í•´ê²°**: `@EntityGraph`ëŠ” ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ë¯€ë¡œ, ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” N+1 ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
- **ë¶€ë¶„ì ì¸ ì¦‰ì‹œ ë¡œë”© ì„¤ì • ê°€ëŠ¥**: íŠ¹ì • ì¿¼ë¦¬ì—ì„œë§Œ ì„ íƒì ìœ¼ë¡œ ì¦‰ì‹œ ë¡œë”©ì„ ì ìš©í•˜ê³  ì‹¶ì„ ë•Œ ìœ ìš©í•˜ë‹¤. ê¸€ë¡œë²Œ ì„¤ì •ì„ ë³€ê²½í•˜ì§€ ì•Šê³  í•„ìš”í•œ ê³³ì—ì„œë§Œ ì¦‰ì‹œ ë¡œë”©ì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.
- **JPQLì´ë‚˜ QueryDSL ì—†ì´ ì‚¬ìš© ê°€ëŠ¥**: JPAì˜ ê¸°ë³¸ ë©”ì„œë“œë‚˜ Spring Data JPAì˜ ë©”ì„œë“œì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆì–´, JPQLì´ë‚˜ QueryDSLì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ ì—°ê´€ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ë¡œë”©í•  ìˆ˜ ìˆë‹¤.


### @EntityGraph ì˜ˆì‹œ
> ì—­ì‹œ Regionì„ ì¡°íšŒì‹œ MemberAddressë„ í•¨ê»˜ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ì˜ˆì‹œ

```java
@Entity
@NamedEntityGraph(
    name = "Region.withMemberAddresses",
    attributeNodes = @NamedAttributeNode("memberAddresses")
)
public class Region extends BaseEntity {
    // ìƒëµ
}
```

### @EntityGraphì˜ ë™ì‘ ë°©ì‹
- `@EntityGraph`ëŠ” `FETCH JOIN`ê³¼ ë¹„ìŠ·í•˜ê²Œ ì‘ë™í•œë‹¤. í•˜ì§€ë§Œ JPQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ì—°ê´€ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”©í•  ìˆ˜ ìˆì–´ ì½”ë“œê°€ ë” ê°„ê²°í•´ì§„ë‹¤.

### @EntityGraphì˜ ì¥ë‹¨ì 
- ì¥ì 
  - ì„ íƒì  ì¦‰ì‹œ ë¡œë”©: íŠ¹ì • ë©”ì„œë“œì—ë§Œ ì¦‰ì‹œ ë¡œë”©ì„ ì ìš©í•  ìˆ˜ ìˆì–´ ì „ì²´ ì—”í‹°í‹° ì„¤ì •ì„ ë³€ê²½í•  í•„ìš”ê°€ ì—†ë‹¤.
  - ê°„í¸í•œ ì„¤ì •: JPQLì´ë‚˜ QueryDSLì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì—°ê´€ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì— ë¡œë”©í•  ìˆ˜ ìˆë‹¤.
  - N+1 ë¬¸ì œ í•´ê²°: ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” N+1 ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
- ë‹¨ì 
  - ë³µì¡í•œ ì—”í‹°í‹° ê·¸ë˜í”„ ì„¤ì •ì´ ì–´ë ¤ì›€: `@EntityGraph`ëŠ” ë³µì¡í•œ ì¡°ê±´ì„ ì„¤ì •í•˜ê¸° ì–´ë ¤ìš°ë¯€ë¡œ, íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ í˜ì¹˜ ì¡°ì¸ì„ ì„¤ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” `JPQL` ë˜ëŠ” `QueryDSL`ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤.
  - í˜ì´ì§•ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ ì£¼ì˜ í•„ìš”: `@OneToMany` ê´€ê³„ì—ì„œ `@EntityGraph`ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” í˜ì´ì§•ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° `Batch Size` ì„¤ì •ì´ ë” ì í•©í•  ìˆ˜ ìˆë‹¤.

### @EntityGraphë¥¼ ì–¸ì œ ì‚¬ìš©í• ê¹Œ?
- íŠ¹ì • ë¦¬í¬ì§€í† ë¦¬ ë©”ì„œë“œì—ì„œë§Œ ì—°ê´€ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”©í•´ì•¼ í•  ë•Œ: ì˜ˆë¥¼ ë“¤ì–´, `findAll` ë©”ì„œë“œì—ì„œë§Œ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í˜ì¹˜ ì¡°ì¸ìœ¼ë¡œ ê°€ì ¸ì™€ì•¼ í•  ë•Œ ìœ ìš©í•˜ë‹¤.
  - ê°„ë‹¨í•œ N+1 ë¬¸ì œ í•´ê²°: `JPQL í˜ì¹˜ ì¡°ì¸`ì´ë‚˜ `QueryDSL`ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ ê°„ë‹¨í•˜ê²Œ N+1 ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
- ë³µì¡í•œ ì¡°ê±´ì´ ì—†ëŠ” ê²½ìš°: ë³µì¡í•œ ì¡°ê±´ì´ ì—†ê³  ë‹¨ìˆœíˆ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”©í•  ë•Œ ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤.

---

## JPQL
### JPQL?
- `Java Persistence Query Language`ì˜ ì¤„ì„ë§ì´ë‹¤. `JPA`ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ì´ë‹¤.
- ***SQLê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, JPQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•œë‹¤.***

### JPQLì˜ íŠ¹ì§•
- ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´: JPQLì€ SQLê³¼ ìœ ì‚¬í•œ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì§€ë§Œ, SQLê³¼ ë‹¬ë¦¬ í…Œì´ë¸”ì´ë‚˜ ì»¬ëŸ¼ì´ ì•„ë‹Œ ì—”í‹°í‹°ì™€ ê·¸ ì†ì„±ì„ ëŒ€ìƒìœ¼ë¡œ í•œë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ë…ë¦½ì : JPQLì€ ë°ì´í„°ë² ì´ìŠ¤ì— ë…ë¦½ì ì´ë¯€ë¡œ, íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì˜ SQL ë¬¸ë²•ì— ì¢…ì†ë˜ì§€ ì•Šê³  ë‹¤ì–‘í•œ DBMSì—ì„œ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- JPAê°€ SQLë¡œ ë³€í™˜: JPQL ì¿¼ë¦¬ëŠ” ì‹¤í–‰ë  ë•Œ JPAì— ì˜í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ëŠ” SQLë¡œ ë³€í™˜ë˜ì–´ ì‹¤í–‰ëœë‹¤.

### JPQLì˜ ê¸°ë³¸ ë¬¸ë²•
- JPQLì˜ ê¸°ë³¸ ë¬¸ë²•ì€ SQLê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, í…Œì´ë¸”ê³¼ ì»¬ëŸ¼ ì´ë¦„ ëŒ€ì‹  `ì—”í‹°í‹°ì™€ ì—”í‹°í‹°ì˜ í•„ë“œ`ë¥¼ ì‚¬ìš©í•œë‹¤.
- `SELECT`: ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•œë‹¤.
- `FROM`: ì¡°íšŒí•  ì—”í‹°í‹°ë¥¼ ì§€ì •í•œë‹¤.
- `WHERE`: ì¡°ê±´ì„ ì§€ì •í•˜ì—¬ ë°ì´í„°ë¥¼ í•„í„°ë§í•œë‹¤.
- `JOIN`: ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¡°ì¸í•˜ì—¬ ê°€ì ¸ì˜¬ ë•Œ ì‚¬ìš©í•œë‹¤.
- `ORDER BY`: ë°ì´í„°ë¥¼ ì •ë ¬í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- `GROUP BY / HAVING`: ê·¸ë£¹í™”í•  ë•Œ ì‚¬ìš©í•˜ë©°, SQLê³¼ ë™ì¼í•œ ì—­í• ì„ í•œë‹¤.

### JPQL ì£¼ì˜ì‚¬í•­
- ì—”í‹°í‹°ì— ì˜ì¡´ì : JPQLì€ ì—”í‹°í‹° ê°ì²´ì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì—, ì—”í‹°í‹° í•„ë“œë‚˜ ê´€ê³„ê°€ ë³€ê²½ë˜ë©´ JPQL ì¿¼ë¦¬ë„ í•¨ê»˜ ìˆ˜ì •í•´ì•¼ í•œë‹¤.
- ë™ì  ì¿¼ë¦¬ì˜ ì–´ë ¤ì›€: JPQLì€ ì •ì ì¸ ì¿¼ë¦¬ ì‘ì„±ì— ì í•©í•˜ì§€ë§Œ, ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” QueryDSLì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ìœ ë¦¬í•  ìˆ˜ ìˆë‹¤.
- ë„¤ì„ë“œ ì¿¼ë¦¬ ì‚¬ìš© ê¶Œì¥: ìì£¼ ì‚¬ìš©ë˜ëŠ” JPQL ì¿¼ë¦¬ëŠ” `@NamedQuery`ë¡œ ë¯¸ë¦¬ ì •ì˜í•´ ë‘ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì„±ëŠ¥ê³¼ ê´€ë¦¬ ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•˜ë‹¤.
---

## QueryDSL
### QueryDSL?
- `QueryDSL`ì€ ìë°”ì—ì„œ íƒ€ì… ì•ˆì „ì„±ì„ ë³´ì¥í•˜ë©´ì„œ ë™ì  ì¿¼ë¦¬ë¥¼ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤.
- ì£¼ë¡œ JPAì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ ***ë™ì  ì¿¼ë¦¬ ì‘ì„± ë° íƒ€ì… ì•ˆì •ì„±***ì„ ë³´ì¥í•˜ëŠ” ë° ìœ ìš©í•˜ë‹¤.
- `JPA`ë§Œìœ¼ë¡œëŠ” ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì–´ë µê¸° ë•Œë¬¸ì—, ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ê°€ í•„ìš”í•  ë•Œ `QueryDSL`ì„ ë§ì´ ì‚¬ìš©í•œë‹¤.

### QueryDSL íŠ¹ì§•
- íƒ€ì… ì•ˆì „ì„±: ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œ ì»´íŒŒì¼ ì‹œì ì— í•„ë“œì˜ íƒ€ì…ì„ ì²´í¬í•  ìˆ˜ ìˆì–´ ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
- ë™ì  ì¿¼ë¦¬ ì‘ì„±: ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸°ê°€ ë§¤ìš° í¸ë¦¬í•˜ë‹¤. ë©”ì„œë“œ ì²´ì´ë‹ì„ í†µí•´ ë³µì¡í•œ ì¡°ê±´ì„ ìœ ì—°í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.
  - `ë©”ì„œë“œ ì²´ì´ë‹`?: ê°ì²´ì˜ ë©”ì„œë“œ í˜¸ì¶œì´ ì—°ì†ì ìœ¼ë¡œ ì´ì–´ì§€ë„ë¡ ì‘ì„±í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ê¸°ë²•ì´ë‹¤. ë©”ì„œë“œ ì²´ì´ë‹ì„ ì‚¬ìš©í•˜ë©´ í•˜ë‚˜ì˜ ë¬¸ì¥ì—ì„œ ì—¬ëŸ¬ ê°œì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆì–´ ì½”ë“œë¥¼ ë” ê°„ê²°í•˜ê³  ì½ê¸° ì‰½ê²Œ ë§Œë“ ë‹¤.
- ê°ì²´ ì§€í–¥ì  ë¬¸ë²•: SQLì´ë‚˜ JPQLê³¼ëŠ” ë‹¬ë¦¬, ë©”ì„œë“œ ì²´ì´ë‹ì„ í™œìš©í•œ ê°ì²´ ì§€í–¥ì  ë¬¸ë²•ì„ ì‚¬ìš©í•œë‹¤. ì½”ë“œê°€ ë” ê¹”ë”í•˜ê³  ê°€ë…ì„±ì´ ì¢‹ë‹¤.

### QueryDSLì˜ ì¥ë‹¨ì 
- ì¥ì 
  - íƒ€ì… ì•ˆì „ì„±: ì»´íŒŒì¼ ì‹œì ì— ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” í•„ë“œì™€ ì¡°ê±´ì„ ì²´í¬í•  ìˆ˜ ìˆì–´ ì˜¤ë¥˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
  - ë™ì  ì¿¼ë¦¬ ì‘ì„± ìš©ì´: ì¡°ê±´ì— ë”°ë¼ ì¿¼ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, `BooleanBuilder`ë¥¼ í†µí•´ ë³µì¡í•œ ì¡°ê±´ë„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
    - `BooleanBuilder`?: QueryDSLì—ì„œ ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œ ì¡°ê±´ì„ ìœ ì—°í•˜ê²Œ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í´ë˜ìŠ¤ë‹¤. íŠ¹ì • ì¡°ê±´ì´ ìˆì„ ë•Œë§Œ í•´ë‹¹ ì¡°ê±´ì„ ì¿¼ë¦¬ì— ì¶”ê°€í•˜ëŠ” ì‹ìœ¼ë¡œ, ì¡°ê±´ì„ ë™ì ìœ¼ë¡œ êµ¬ì„±í•˜ëŠ” ë° ìœ ìš©í•˜ë‹¤.
  - ì½”ë“œ ê°€ë…ì„± í–¥ìƒ: ë©”ì„œë“œ ì²´ì´ë‹ê³¼ ê°ì²´ ì§€í–¥ì ì¸ ë¬¸ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì½”ë“œê°€ ê¹”ë”í•˜ê³  ê°€ë…ì„±ì´ ë†’ì•„ì§„ë‹¤.

- ë‹¨ì 
  - ì„¤ì • ë° ì´ˆê¸° í•™ìŠµ ì½”ìŠ¤íŠ¸: `QueryDSL`ì„ ì‚¬ìš©í•˜ë ¤ë©´ í”„ë¡œì íŠ¸ì— ë³„ë„ì˜ ì„¤ì •ì´ í•„ìš”í•˜ë©°, `Q í´ë˜ìŠ¤`ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.
  - `JPQL` ëŒ€ë¹„ ì½”ë“œê°€ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆë‹¤: ê°„ë‹¨í•œ ì¿¼ë¦¬ì˜ ê²½ìš°, `QueryDSL`ì´ ì˜¤íˆë ¤ `JPQL`ë³´ë‹¤ ì½”ë“œê°€ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆë‹¤.

### QueryDSLì˜ ì˜ˆì‹œ
- https://github.com/ahtop00/Spring_Practice_Mission/tree/master/src/main/java/javalab/umc7th_mission/repository
- í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ QueryDSLì„ í†µí•´ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

---

## N+1ë¬¸ì œì˜ í•´ê²°ì±…
> 5ì£¼ì°¨ Keywordì˜ ì—°ì¥ì„ ì…ë‹ˆë‹¤.

### 1. í˜ì¹˜ ì¡°ì¸(Fetch Join) ì‚¬ìš©
- í˜ì¹˜ ì¡°ì¸(Fetch Join)ì„ ì‚¬ìš©í•˜ë©´, ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ë‹¨ì¼ ì¿¼ë¦¬ë¡œ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. 
- `JPA`ì˜ `JPQL`ì—ì„œ `JOIN FETCH` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”©í•  ìˆ˜ ìˆë‹¤.
```java
// JPQLì„ ì‚¬ìš©í•œ í˜ì¹˜ ì¡°ì¸
List<Region> regions = entityManager.createQuery(
    "SELECT r FROM Region r JOIN FETCH r.memberAddresses", Region.class)
    .getResultList();
```
- í•´ë‹¹ ì½”ë“œì—ì„œ `JOIN FETCH`ë¥¼ ì‚¬ìš©í•˜ì—¬, `Region`ê³¼ `MemberAdress`ë¥¼ í•œë²ˆì— ì¡°íšŒí•˜ì—¬ ì¶”ê°€ ì¿¼ë¦¬ë¥¼ ë°©ì§€í•œë‹¤.

### 2. ì—”í‹°í‹° ê·¸ë˜í”„(Entity Graph) ì‚¬ìš©
- JPAì˜ `@EntityGraph` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ì—°ê´€ ê´€ê³„ë¥¼ ë¯¸ë¦¬ ì •ì˜í•˜ê³ , íŠ¹ì • ì¿¼ë¦¬ì—ì„œ ì´ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.
- ì´ë¥¼ í†µí•´ ì›í•˜ëŠ” ì¿¼ë¦¬ì—ì„œë§Œ ì—°ê´€ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
```java
@Entity
@NamedEntityGraph(name = "Region.withMemberAddresses",
                 attributeNodes = @NamedAttributeNode("memberAddresses"))
public class Region {
    //ìƒëµ
}

// Repositoryì—ì„œ @EntityGraph ì‚¬ìš©
public interface RegionRepository extends JpaRepository<Region, Long> {

    @EntityGraph(value = "Region.withMemberAddresses")
    List<Region> findAll();
}
```
- í•´ë‹¹ ì½”ë“œì—ì„œ `@NamedEntityGraph`ë¥¼ ì‚¬ìš©, `Region` ì—”í‹°í‹°ì™€ ì—°ê´€ëœ `MemberAddress`ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ì—”í‹°í‹° ê·¸ë˜í”„ë¥¼ ì •ì˜í•œë‹¤.

### 3. Batch Size ì„¤ì •í•˜ê¸°
- í•œ ë²ˆì— ë¡œë”©í•  ì—”í‹°í‹° ê°œìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
- ì´ë¥¼ í†µí•´ì„œ í•œ ë²ˆì— ì—¬ëŸ¬ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, í˜¸ì¶œ íšŸìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
```java
@Entity
public class Region {

    @OneToMany(mappedBy = "region")
    @BatchSize(size = 10)
    private List<MemberAddress> memberAddresses;
}
```
- í•´ë‹¹ ì½”ë“œì—ì„œ `BatchSize = 10`ì„ í†µí•´ ìµœëŒ€ 10ê°œì˜ `MemberAddress`ë¥¼ í•œë²ˆì— ê°€ì ¸ì˜¨ë‹¤.
- ë”°ë¼ì„œ `Region`ì´ 10ê°œë¼ë©´ 1 + 1 = 2ê°œì˜ ì¿¼ë¦¬ë¡œ í•´ê²°ëœë‹¤.

### 4. QueryDSLì˜ í˜ì¹˜ ì¡°ì¸(Fetch Join) ì‚¬ìš©
- `QueryDSL`ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•´ ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ì—°ê´€ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
```java
QRegion region = QRegion.region;
QMemberAddress memberAddress = QMemberAddress.memberAddress;

List<Region> regions = queryFactory
    .selectFrom(region)
    .leftJoin(region.memberAddresses, memberAddress).fetchJoin()
    .fetch();

```
- `QueryDSL`ì—ì„œ `fetchJoin()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´, í˜ì¹˜ ì¡°ì¸ì„ í†µí•´ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.